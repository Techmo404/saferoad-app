<div class="history-container">
  
  <h2>Historial de Riesgos</h2>

  <!-- Loader -->
  <div *ngIf="loading">â³ Cargando historial...</div>

  <!-- Si estÃ¡ vacÃ­o -->
  <div *ngIf="!loading && history.length === 0" class="empty">
    ğŸš« No hay registros aÃºn.
  </div>

  <!-- Mostrar lista -->
  <div *ngIf="!loading && history.length > 0">
    <div *ngFor="let item of history; trackBy: trackById" class="card">

      <p><strong>ğŸ“… Fecha:</strong> {{ item.datetime }}</p>
      <p><strong>ğŸŒ¡ Temperatura:</strong> {{ item.weather?.main?.temp }}Â°C</p>
      <p><strong>ğŸŒ¤ Cielo:</strong> {{ item.weather?.weather?.[0]?.description }}</p>
      <p><strong>ğŸš¦ TrÃ¡fico:</strong> Nivel {{ item.traffic?.level }} ({{ item.traffic?.status }})</p>

      <div>
        <strong>âš  Alertas:</strong>

        <!-- Protegido para valores undefined -->
        <ul *ngIf="item.alerts?.length > 0">
          <li *ngFor="let a of item.alerts">{{ a }}</li>
        </ul>

        <span *ngIf="!item.alerts || item.alerts.length === 0">
          ğŸŸ¢ Ninguna
        </span>
      </div>

    </div>
  </div>

  <!-- GrÃ¡fico -->
  <canvas id="riskChart" width="400" height="250"></canvas>

</div>
