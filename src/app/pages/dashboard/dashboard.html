
<!-- ğŸ”¹ Barra superior con botÃ³n de salir -->
<div class="top-bar">
  <h2 class="title">SafeRoad Dashboard</h2>
  <button class="logout-btn" (click)="logout()">Cerrar sesiÃ³n</button>
</div>

<div class="dashboard-container">

  <!-- ğŸ”¥ BOTÃ“N PRINCIPAL -->
  <button class="risk-btn" (click)="getRisk()">
    ğŸš¦ Analizar riesgo en esta ubicaciÃ³n
  </button>


  <!-- ğŸ§  RESULTADO DE LA IA -->
  <div *ngIf="riskResult" 
       class="alert text-center mt-3"
       [ngClass]="{
        'alert-success': riskResult.predicted_risk === 'Bajo',
        'alert-warning': riskResult.predicted_risk === 'Medio',
        'alert-danger': riskResult.predicted_risk === 'Alto' || riskResult.predicted_risk === 'CrÃ­tico'
       }">

    <h3>Resultado IA</h3>
    <strong>Riesgo detectado:</strong> {{ riskResult.predicted_risk }} ğŸš¦<br>
    <strong>Coordenadas:</strong> {{ riskResult.coords?.lat | number:'1.4-4' }},
    {{ riskResult.coords?.lng | number:'1.4-4' }} <br>
    <small>ğŸ•’ {{ riskResult.datetime }} â€” Modelo: {{ riskResult.model }}</small>
  </div>


  <!-- ğŸ—ºï¸ MAPA -->
  <div id="map" style="height: 350px; width: 100%; margin-top: 20px;"></div>


  <!-- ğŸ“œ HISTORIAL -->
  <div class="history-container">
  
    <h2 class="mt-4">Historial de Riesgos</h2>

    <!-- Loader -->
    <div *ngIf="loading">â³ Cargando historial...</div>

    <!-- Si estÃ¡ vacÃ­o -->
    <div *ngIf="!loading && history.length === 0" class="empty">
      ğŸš« No hay registros aÃºn.
    </div>

    <!-- Mostrar lista -->
    <div *ngIf="!loading && history.length > 0">
      <div *ngFor="let item of history; trackBy: trackById" class="card">

        <p><strong>ğŸ“… Fecha:</strong> {{ item.datetime }}</p>
        <p><strong>ğŸ“ UbicaciÃ³n:</strong> {{ item.coords?.lat }}, {{ item.coords?.lng }}</p>
        <p><strong>ğŸŒ¡ Temp:</strong> {{ item.weather?.main?.temp }}Â°C</p>
        <p><strong>ğŸŒ¤ Cielo:</strong> {{ item.weather?.weather?.[0]?.description }}</p>
        <p><strong>ğŸš¦ Riesgo:</strong> 
          <span [ngClass]="{
            'text-success': item.predicted_risk === 'Bajo',
            'text-warning': item.predicted_risk === 'Medio',
            'text-danger': item.predicted_risk === 'Alto' || item.predicted_risk === 'CrÃ­tico'
          }">
            {{ item.predicted_risk }}
          </span>
        </p>

        <hr>
      </div>
    </div>

  </div>

  <canvas id="riskChart" width="400" height="250"></canvas>
</div>
